% Decentralized Adaptive Control of Interconnected Systems

% Fig.1 with usual adaptive controller
clc
clear
k01 = 1.5; k02 = 1;
% f = @(t,x) [(-2-x(5))*x(1)-(x(5)+1)*x(3)-0.5*(x(2)+x(4)); (-1.5-x(6))*x(2)-(x(6)+0.5)*x(4); -x(3)+1; -x(4)+4; x(1)*(x(1)+x(3)); x(2)*(x(2)+x(4))];

% Modified controller
f = @(t,x) [(-2-x(5))*x(1)-(x(5)+1)*x(3)-0.5*(x(2)+x(4)); (-1.5-x(6))*x(2)-(x(6)+0.5)*x(4); -x(3)+1; -x(4)+4; x(1)*(x(1)+x(3))-0.05*x(5)*(abs(x(5)>k01)); x(2)*(x(2)+x(4))-0.01*x(6)*(abs(x(6)>k02))];

[t,xa] = ode45(f,[0 40],[0 0 0 0 0 0]);

subplot(2,1,2)
plot(t,xa(:,2))
xlabel('time','fontweight','bold','fontsize',16);
ylabel('error 2','fontweight','bold','fontsize',16);

subplot(2,1,1)
plot(t,xa(:,1))
xlabel('time','fontweight','bold','fontsize',16);
ylabel('error 1','fontweight','bold','fontsize',16);

subplot(2,1,1)
plot(t,xa(:,5))
xlabel('time','fontweight','bold','fontsize',16);
ylabel('K1(t)','fontweight','bold','fontsize',16);

subplot(2,1,2)
plot(t,xa(:,6))
xlabel('time','fontweight','bold','fontsize',16);
ylabel('K2(t)','fontweight','bold','fontsize',16);

figure(5)
plot(t,xa(:,3))
title('xm1(t)')
xlabel('t'), ylabel('xm1')




% f = @(t,x) [(-2-x(5))*x(1)-(x(5)+1)*x(3)-0.5*(x(2)+x(4)); (-1.5-x(6))*x(2)-(x(6)+0.5)*x(4); -x(3)+1; -x(4)+4; x(1)*(x(1)+x(3))-0.05*x(5)*(abs(x(5)>k01)); x(2)*(x(2)+x(4))-0.01*x(6)*(abs(x(6)>k02))];


% f = @(t,x) [x(2)+0.1*x(3); x(1)-2*x(2)+x(4)*x(10)+x(5)*x(11)+x(6)*x(1)+(-5*(x(1)-(-0.3*cos(t)+0.1*sin(t)+0.5*exp(-t)-0.2*exp(-2*t)))*x(7)-7.5*abs((x(4)^2+x(5)^2+x(6)^2)>4)*(1+x(7)^2+x(8)^2+x(9)^2)*x(4))*x(7)+(-5*(x(1)-(-0.3*cos(t)+0.1*sin(t)+0.5*exp(-t)-0.2*exp(-2*t)))*x(8)-7.5*abs((x(4)^2+x(5)^2+x(6)^2)>4)*(1+x(7)^2+x(8)^2+x(9)^2)*x(5))*x(8)+(-5*(x(1)-(-0.3*cos(t)+0.1*sin(t)+0.5*exp(-t)-0.2*exp(-2*t)))*x(9)-7.5*abs((x(4)^2+x(5)^2+x(6)^2)>4)*(1+x(7)^2+x(8)^2+x(9)^2)*x(6))*x(9)+4*sin(t)+0.2*x(3)*sin(x(1)^2);-x(3)+x(12)*x(3)+6+0.02*x(2)*cos(x(2)^2)+1.1*x(3)*cos(2*t);-5*(x(1)-(-0.3*cos(t)+0.1*sin(t)+0.5*exp(-t)-0.2*exp(-2*t)))*x(7)-7.5*abs((x(4)^2+x(5)^2+x(6)^2)>4)*(1+x(7)^2+x(8)^2+x(9)^2)*x(4);-5*(x(1)-(-0.3*cos(t)+0.1*sin(t)+0.5*exp(-t)-0.2*exp(-2*t)))*x(8)-7.5*abs((x(4)^2+x(5)^2+x(6)^2)>4)*(1+x(7)^2+x(8)^2+x(9)^2)*x(5);-5*(x(1)-(-0.3*cos(t)+0.1*sin(t)+0.5*exp(-t)-0.2*exp(-2*t)))*x(9)-7.5*abs((x(4)^2+x(5)^2+x(6)^2)>4)*(1+x(7)^2+x(8)^2+x(9)^2)*x(6);x(10)-0.5*x(7);x(11)-0.5*x(8);x(1)-0.5*x(9);x(4)*x(10)+x(5)*x(11)+x(6)*x(1)+(-5*(x(1)-(-0.3*cos(t)+0.1*sin(t)+0.5*exp(-t)-0.2*exp(-2*t)))*x(7)-7.5*abs((x(4)^2+x(5)^2+x(6)^2)>4)*(1+x(7)^2+x(8)^2+x(9)^2)*x(4))*x(7)+(-5*(x(1)-(-0.3*cos(t)+0.1*sin(t)+0.5*exp(-t)-0.2*exp(-2*t)))*x(8)-7.5*abs((x(4)^2+x(5)^2+x(6)^2)>4)*(1+x(7)^2+x(8)^2+x(9)^2)*x(5))*x(8)+(-5*(x(1)-(-0.3*cos(t)+0.1*sin(t)+0.5*exp(-t)-0.2*exp(-2*t)))*x(9)-7.5*abs((x(4)^2+x(5)^2+x(6)^2)>4)*(1+x(7)^2+x(8)^2+x(9)^2)*x(6))*x(9)+4*sin(t)-x(10);x(1)-x(11);-4*0.4*abs(x(12)>=6)*x(12)-4*(x(3)-6*exp(-5*t))*x(3)];
[t,xa] = ode45(f,[0 40],[0 0 0 0 0 0 0 0 0 0 0 0]);
e01 = -5*(xa(1)-(-0.3*cos(t)+0.1*sin(t)+0.5*exp(-t)-0.2*exp(-2*t)));
e02 = xa(3)-6*exp(-5*t);
subplot(2,1,1)
plot(t,e01)
xlabel('time','fontweight','bold','fontsize',16);
ylabel('e1','fontweight','bold','fontsize',16);
subplot(2,1,2)
plot(t,e02)
xlabel('time','fontweight','bold','fontsize',16);
ylabel('e2','fontweight','bold','fontsize',16);
axis([0 40 -3 3])

subplot(3,1,1)
plot(t,xa(:,4))
xlabel('time','fontweight','bold','fontsize',16);
ylabel('K11','fontweight','bold','fontsize',16);
axis([0 40 -3 3])
subplot(3,1,2)
plot(t,xa(:,5))
xlabel('time','fontweight','bold','fontsize',16);
ylabel('K12','fontweight','bold','fontsize',16);
axis([0 40 -3 3])
subplot(3,1,3)
plot(t,xa(:,6))
xlabel('time','fontweight','bold','fontsize',16);
ylabel('K13','fontweight','bold','fontsize',16);
axis([0 40 -3 3])

 f = @(t,x) [x(2)+0.1*x(3); x(1)-2*x(2)+x(4)*x(10)+x(5)*x(11)+x(6)*x(1)+(-5*(x(1)-(-0.3*cos(t)+0.1*sin(t)+0.5*exp(-t)-0.2*exp(-2*t)))*x(7)-7.5*((x(4)^2+x(5)^2+x(6)^2)>4)*(1+x(7)^2+x(8)^2+x(9)^2)*x(4))*x(7)+(-5*(x(1)-(-0.3*cos(t)+0.1*sin(t)+0.5*exp(-t)-0.2*exp(-2*t)))*x(8)-7.5*((x(4)^2+x(5)^2+x(6)^2)>4)*(1+x(7)^2+x(8)^2+x(9)^2)*x(5))*x(8)+(-5*(x(1)-(-0.3*cos(t)+0.1*sin(t)+0.5*exp(-t)-0.2*exp(-2*t)))*x(9)-7.5*((x(4)^2+x(5)^2+x(6)^2)>4)*(1+x(7)^2+x(8)^2+x(9)^2)*x(6))*x(9)+4*sin(t)+0.2*x(3)*sin(x(1)^2);-x(3)+x(12)*x(3)+6+0.02*x(2)*cos(x(2)^2)+1.1*x(3)*cos(2*t);-5*(x(1)-(-0.3*cos(t)+0.1*sin(t)+0.5*exp(-t)-0.2*exp(-2*t)))*x(7)-7.5*((x(4)^2+x(5)^2+x(6)^2)>4)*(1+x(7)^2+x(8)^2+x(9)^2)*x(4);-5*(x(1)-(-0.3*cos(t)+0.1*sin(t)+0.5*exp(-t)-0.2*exp(-2*t)))*x(8)-7.5*((x(4)^2+x(5)^2+x(6)^2)>4)*(1+x(7)^2+x(8)^2+x(9)^2)*x(5);-5*(x(1)-(-0.3*cos(t)+0.1*sin(t)+0.5*exp(-t)-0.2*exp(-2*t)))*x(9)-7.5*((x(4)^2+x(5)^2+x(6)^2)>4)*(1+x(7)^2+x(8)^2+x(9)^2)*x(6);x(10)-0.5*x(7);x(11)-0.5*x(8);x(1)-0.5*x(9);x(4)*x(10)+x(5)*x(11)+x(6)*x(1)+(-5*(x(1)-(-0.3*cos(t)+0.1*sin(t)+0.5*exp(-t)-0.2*exp(-2*t)))*x(7)-7.5*((x(4)^2+x(5)^2+x(6)^2)>4)*(1+x(7)^2+x(8)^2+x(9)^2)*x(4))*x(7)+(-5*(x(1)-(-0.3*cos(t)+0.1*sin(t)+0.5*exp(-t)-0.2*exp(-2*t)))*x(8)-7.5*((x(4)^2+x(5)^2+x(6)^2)>4)*(1+x(7)^2+x(8)^2+x(9)^2)*x(5))*x(8)+(-5*(x(1)-(-0.3*cos(t)+0.1*sin(t)+0.5*exp(-t)-0.2*exp(-2*t)))*x(9)-7.5*((x(4)^2+x(5)^2+x(6)^2)>4)*(1+x(7)^2+x(8)^2+x(9)^2)*x(6))*x(9)+4*sin(t)-x(10);x(1)-x(11);-4*0.4*abs(x(12)>=6)*x(12)-4*(x(3)-6*exp(-5*t))*x(3)];


% Without interconnection
f = @(t,x) [x(2); x(1)-2*x(2)+x(4)*x(10)+x(5)*x(11)+x(6)*x(1)+(-5*(x(1)-(-0.3*cos(t)+0.1*sin(t)+0.5*exp(-t)-0.2*exp(-2*t)))*x(7)-7.5*((x(4)^2+x(5)^2+x(6)^2)>4)*(1+x(7)^2+x(8)^2+x(9)^2)*x(4))*x(7)+(-5*(x(1)-(-0.3*cos(t)+0.1*sin(t)+0.5*exp(-t)-0.2*exp(-2*t)))*x(8)-7.5*((x(4)^2+x(5)^2+x(6)^2)>4)*(1+x(7)^2+x(8)^2+x(9)^2)*x(5))*x(8)+(-5*(x(1)-(-0.3*cos(t)+0.1*sin(t)+0.5*exp(-t)-0.2*exp(-2*t)))*x(9)-7.5*((x(4)^2+x(5)^2+x(6)^2)>4)*(1+x(7)^2+x(8)^2+x(9)^2)*x(6))*x(9)+4*sin(t);-x(3)+x(12)*x(3)+6+1.1*x(3)*cos(2*t);-5*(x(1)-(-0.3*cos(t)+0.1*sin(t)+0.5*exp(-t)-0.2*exp(-2*t)))*x(7)-7.5*((x(4)^2+x(5)^2+x(6)^2)>4)*(1+x(7)^2+x(8)^2+x(9)^2)*x(4);-5*(x(1)-(-0.3*cos(t)+0.1*sin(t)+0.5*exp(-t)-0.2*exp(-2*t)))*x(8)-7.5*((x(4)^2+x(5)^2+x(6)^2)>4)*(1+x(7)^2+x(8)^2+x(9)^2)*x(5);-5*(x(1)-(-0.3*cos(t)+0.1*sin(t)+0.5*exp(-t)-0.2*exp(-2*t)))*x(9)-7.5*((x(4)^2+x(5)^2+x(6)^2)>4)*(1+x(7)^2+x(8)^2+x(9)^2)*x(6);x(10)-0.5*x(7);x(11)-0.5*x(8);x(1)-0.5*x(9);x(4)*x(10)+x(5)*x(11)+x(6)*x(1)+(-5*(x(1)-(-0.3*cos(t)+0.1*sin(t)+0.5*exp(-t)-0.2*exp(-2*t)))*x(7)-7.5*((x(4)^2+x(5)^2+x(6)^2)>4)*(1+x(7)^2+x(8)^2+x(9)^2)*x(4))*x(7)+(-5*(x(1)-(-0.3*cos(t)+0.1*sin(t)+0.5*exp(-t)-0.2*exp(-2*t)))*x(8)-7.5*((x(4)^2+x(5)^2+x(6)^2)>4)*(1+x(7)^2+x(8)^2+x(9)^2)*x(5))*x(8)+(-5*(x(1)-(-0.3*cos(t)+0.1*sin(t)+0.5*exp(-t)-0.2*exp(-2*t)))*x(9)-7.5*((x(4)^2+x(5)^2+x(6)^2)>4)*(1+x(7)^2+x(8)^2+x(9)^2)*x(6))*x(9)+4*sin(t)-x(10);x(1)-x(11);-4*0.4*(abs(x(12)>=6))*x(12)-4*(x(3)-6*exp(-5*t))*x(3)];


A1 = [0 1;1 0];
b = [0 1]';
A2 = [0 0;-2 0];
A12 = -A2;
H = [1.5 0.5;0.5 0.5];
bm = [0 1]';
k = H*bm;
sig = 0.01;
tspan = [0 40];
f = @(t,x) [A1*x(1)+b*x(3)'*x(1)+A2*x(1)-A2*x(2);A1*x(2)+b*x(4)'*x(2)-A2*x(1)+A2*x(2);-k'*x(1)*x(1)-sig*x(3);-k'*x(2)*x(2)-sig*x(4)];
[t,xa] = ode45(f,tspan,[0 0 0 0 0 0 0 0 0 0 0 0]);



    